FROM node:18

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
ARG REACT_APP_PRODUCT_API
ARG REACT_APP_RECOMMENDATION_API

ENV REACT_APP_PRODUCT_API=$REACT_APP_PRODUCT_API
ENV REACT_APP_RECOMMENDATION_API=$REACT_APP_RECOMMENDATION_API

RUN REACT_APP_PRODUCT_API=$REACT_APP_PRODUCT_API \
    REACT_APP_RECOMMENDATION_API=$REACT_APP_RECOMMENDATION_API \
    npm run build
    
RUN npm install -g serve

EXPOSE 3000
CMD ["serve", "-s", "build", "-l", "3000"]
